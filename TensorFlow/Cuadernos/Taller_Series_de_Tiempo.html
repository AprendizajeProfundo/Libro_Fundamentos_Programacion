
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Pronóstico de Series de Tiempo en Tensorflow &#8212; Fundamentos de Programación</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-final-ap.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Fundamentos de Programación</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../tutorial.html">
                    <span style="color:#F72585">Bienvenido(a)</span>
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Primeros Pasos
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Inicio/Cuadernos/Consideraciones.html">
   <span style="color:#F72585">
    Conociendo el Libro
   </span>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introducción
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/py0.html">
   <span style="color:#F72585">
    Conceptos básicos de programación
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/py1.html">
   <span style="color:#F72585">
    Introducción al lenguaje de programación Python
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/py2.html">
   <span style="color:#F72585">
    Tipos de Datos Básicos
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/py3.html">
   <span style="color:#F72585">
    Operadores aritméticos y lógicos
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/py4.html">
   <span style="color:#F72585">
    Estructuras de control
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/py5.html">
   <span style="color:#F72585">
    Funciones en Python
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/Colecciones.html">
   <span style="color:#F72585">
    Listas, Tuplas y Diccionarios en Python
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/Taller_Numpy.html">
   <span style="color:#F72585">
    Taller de numpy
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Cuadernos/Taller_Pandas.html">
   <span style="color:#F72585">
    Taller de manejo de Datos en Pandas
   </span>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Pytorch
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Pytorch/Cuadernos/Pytorch_01.html">
   <span style="color:#F72585">
    Inicio Rápido
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Pytorch/Cuadernos/Pytorch_02.html">
   <span style="color:#F72585">
    Tensores
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Pytorch/Cuadernos/Pytorch_03.html">
   <span style="color:#F72585">
    DataSets y DataLoaders
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Pytorch/Cuadernos/Pytorch_04.html">
   <span style="color:#F72585">
    Transforms
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Pytorch/Cuadernos/Pytorch_05.html">
   <span style="color:#F72585">
    Diferenciación automática con torch.autograd
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Pytorch/Cuadernos/Pytorch_06.html">
   <span style="color:#F72585">
    Optimización con torch
   </span>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  TensorFlow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Tensorflow-01.html">
   <span style="color:#F72585">
    Inicio Rápido
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="La_API_tf_data.html">
   <span style="color:#F72585">
    Canalización de datos. La API tf.data
   </span>
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/AprendizajeProfundo/Libro_Fundamentos_Programacion/main?urlpath=tree/TensorFlow/Cuadernos/Taller_Series_de_Tiempo.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/AprendizajeProfundo/Libro_Fundamentos_Programacion/blob/main/TensorFlow/Cuadernos/Taller_Series_de_Tiempo.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/AprendizajeProfundo/Libro_Fundamentos_Programacion"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/AprendizajeProfundo/Libro_Fundamentos_Programacion/issues/new?title=Issue%20on%20page%20%2FTensorFlow/Cuadernos/Taller_Series_de_Tiempo.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/AprendizajeProfundo/Libro_Fundamentos_Programacion/edit/main/TensorFlow/Cuadernos/Taller_Series_de_Tiempo.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/TensorFlow/Cuadernos/Taller_Series_de_Tiempo.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-escritor-span">
   <span style="color:blue">
    Escritor
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-introduccion-span">
   <span style="color:blue">
    Introducción
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-paquetes-a-utilizar-span">
   <span style="color:blue">
    Paquetes a utilizar
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-acciones-de-la-empresa-apple-span">
     <span style="color:red">
      Acciones de la empresa Apple
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-preparacion-de-los-datos-para-el-entrenamiento-de-la-red-lstm-span">
   <span style="color:blue">
    Preparación de los datos para el entrenamiento de la red LSTM
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-crea-datos-de-entrenamiento-span">
   <span style="color:blue">
    Crea datos de entrenamiento
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-blue-funcion-para-crear-los-datos-entrenamiento-span">
     <span style="color:blue">
      Función para crear los datos entrenamiento
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-crea-el-modelo-lstm-span">
   <span style="color:blue">
    Crea el modelo LSTM
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-compila-span">
   <span style="color:blue">
    Compila
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-entrena-el-modelo-span">
   <span style="color:blue">
    Entrena el modelo
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-predicciones-span">
   <span style="color:blue">
    Predicciones
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-blue-funcion-para-graficar-predicciones-span">
     <span style="color:blue">
      Función para graficar predicciones
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-caso-multipaso-span">
   <span style="color:blue">
    Caso multipaso
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-base-de-datos-weather-span">
     <span style="color:red">
      Base de Datos “Weather”
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-pre-procesamiento-span">
     <span style="color:red">
      Pre procesamiento
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#viento">
       Viento
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tiempo">
       Tiempo
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#separacion-de-los-datos">
       Separación de los datos
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#normalizacion-de-los-datos">
       Normalización de los datos
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-ventaneo-de-datos-span">
     <span style="color:red">
      Ventaneo de Datos
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indices-y-offsets">
       Índices y offsets
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#corte">
       Corte
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#graficas">
       Gráficas
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#creacion-de-datasets">
       Creación de Datasets
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-modelo-a-un-paso-span">
     <span style="color:red">
      Modelo a un paso
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#base-de-referencia">
       Base de referencia
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelo-lineal">
       Modelo Lineal
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#denso-multi-paso">
       Denso Multi paso
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#red-recurrente">
     Red Recurrente
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rendimiento">
       Rendimiento
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelos-multivariados">
       Modelos multivariados
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-modelo-multi-paso-span">
     <span style="color:red">
      Modelo multi paso
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Base de referencia
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelos-single-shot">
       Modelos Single shot
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lineal">
       Lineal
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#densa">
       Densa
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rnn">
       RNN
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Rendimiento
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1><span style="color:red"><center>Pronóstico de Series de Tiempo en Tensorflow</center></span></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-escritor-span">
   <span style="color:blue">
    Escritor
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-introduccion-span">
   <span style="color:blue">
    Introducción
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-paquetes-a-utilizar-span">
   <span style="color:blue">
    Paquetes a utilizar
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-acciones-de-la-empresa-apple-span">
     <span style="color:red">
      Acciones de la empresa Apple
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-preparacion-de-los-datos-para-el-entrenamiento-de-la-red-lstm-span">
   <span style="color:blue">
    Preparación de los datos para el entrenamiento de la red LSTM
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-crea-datos-de-entrenamiento-span">
   <span style="color:blue">
    Crea datos de entrenamiento
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-blue-funcion-para-crear-los-datos-entrenamiento-span">
     <span style="color:blue">
      Función para crear los datos entrenamiento
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-crea-el-modelo-lstm-span">
   <span style="color:blue">
    Crea el modelo LSTM
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-compila-span">
   <span style="color:blue">
    Compila
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-entrena-el-modelo-span">
   <span style="color:blue">
    Entrena el modelo
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-predicciones-span">
   <span style="color:blue">
    Predicciones
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-blue-funcion-para-graficar-predicciones-span">
     <span style="color:blue">
      Función para graficar predicciones
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-blue-caso-multipaso-span">
   <span style="color:blue">
    Caso multipaso
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-base-de-datos-weather-span">
     <span style="color:red">
      Base de Datos “Weather”
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-pre-procesamiento-span">
     <span style="color:red">
      Pre procesamiento
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#viento">
       Viento
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tiempo">
       Tiempo
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#separacion-de-los-datos">
       Separación de los datos
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#normalizacion-de-los-datos">
       Normalización de los datos
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-ventaneo-de-datos-span">
     <span style="color:red">
      Ventaneo de Datos
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indices-y-offsets">
       Índices y offsets
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#corte">
       Corte
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#graficas">
       Gráficas
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#creacion-de-datasets">
       Creación de Datasets
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-modelo-a-un-paso-span">
     <span style="color:red">
      Modelo a un paso
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#base-de-referencia">
       Base de referencia
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelo-lineal">
       Modelo Lineal
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#denso-multi-paso">
       Denso Multi paso
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#red-recurrente">
     Red Recurrente
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rendimiento">
       Rendimiento
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelos-multivariados">
       Modelos multivariados
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-modelo-multi-paso-span">
     <span style="color:red">
      Modelo multi paso
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Base de referencia
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelos-single-shot">
       Modelos Single shot
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lineal">
       Lineal
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#densa">
       Densa
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rnn">
       RNN
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Rendimiento
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="span-style-color-red-center-pronostico-de-series-de-tiempo-en-tensorflow-center-span">
<h1><span style="color:red"><center>Pronóstico de Series de Tiempo en Tensorflow</center></span><a class="headerlink" href="#span-style-color-red-center-pronostico-de-series-de-tiempo-en-tensorflow-center-span" title="Permalink to this headline">#</a></h1>
<section id="span-style-color-blue-escritor-span">
<h2><span style="color:blue">Escritor</span><a class="headerlink" href="#span-style-color-blue-escritor-span" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Oleg Jarma, Estadístico, <a class="reference external" href="mailto:ojarmam&#37;&#52;&#48;unal&#46;edu&#46;co">ojarmam<span>&#64;</span>unal<span>&#46;</span>edu<span>&#46;</span>co</a></p></li>
</ul>
</section>
<section id="span-style-color-blue-introduccion-span">
<h2><span style="color:blue">Introducción</span><a class="headerlink" href="#span-style-color-blue-introduccion-span" title="Permalink to this headline">#</a></h2>
<p>Basado en este <a class="reference external" href="https://www.tensorflow.org/tutorials/structured_data/time_series#advanced_autoregressive_model">tutorial</a></p>
<p>Observaremos cómo utilizar redes neuronales para hacer pronósticos de series de tiempo. Se utilizarán Redes Recurrentes y Redes Convolucionales.</p>
<p>En esta guía veremos:</p>
<ul class="simple">
<li><p>Pronóstico a un paso</p>
<ul>
<li><p>Una característica</p></li>
<li><p>Varias características</p></li>
</ul>
</li>
<li><p>Pronóstico de muchos pasos</p>
<ul>
<li><p>Todos los pronósticos a la vez</p></li>
<li><p>Modelo autorregresivo</p></li>
</ul>
</li>
</ul>
</section>
<section id="span-style-color-blue-paquetes-a-utilizar-span">
<h2><span style="color:blue">Paquetes a utilizar</span><a class="headerlink" href="#span-style-color-blue-paquetes-a-utilizar-span" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">IPython</span>
<span class="kn">import</span> <span class="nn">IPython.display</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<section id="span-style-color-red-acciones-de-la-empresa-apple-span">
<h3><span style="color:red">Acciones de la empresa Apple</span><a class="headerlink" href="#span-style-color-red-acciones-de-la-empresa-apple-span" title="Permalink to this headline">#</a></h3>
<p>Estos datos corresponden a la empresa <em>Apple</em>. Son  3019 datos que corresponden a observaciones del precio de la acción, el número de transacciones de la acción (compra-venta). Los datos son diarios (dias hábiles o comerciales). Están entre el 3 de enero de 2006 hasta el 1 de enero de 2018.</p>
<p>la columna <em>Date</em> es la fecha, <em>Open</em> es el valor de acción a la apertura del mercado, <em>High</em> el valor más alto alcanzado en el día, <em>Low</em> el valor más bajo del día, <em>Close</em> el valor al cierre,  <em>Volume</em> es el volúmenes de acciones transadas en el día  y <em>Name</em> es el código de identificación de la empresa, Apple en este caso.</p>
<p>Los datos puede ser bajados directamente de <a class="reference external" href="https://www.kaggle.com/szrlee/stock-time-series-20050101-to-20171231">Kaggle</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#leemos el archivo de manera local</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/AprendizajeProfundo/Libro_Fundamentos_Programacion/main/TensorFlow/Datos/AAPL_2006-01-01_to_2018-01-01.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Observamos los primeros datos</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Shape of the data:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Shape of the data:
(3019, 7)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2006-01-03</td>
      <td>10.34</td>
      <td>10.68</td>
      <td>10.32</td>
      <td>10.68</td>
      <td>201853036</td>
      <td>AAPL</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2006-01-04</td>
      <td>10.73</td>
      <td>10.85</td>
      <td>10.64</td>
      <td>10.71</td>
      <td>155225609</td>
      <td>AAPL</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2006-01-05</td>
      <td>10.69</td>
      <td>10.70</td>
      <td>10.54</td>
      <td>10.63</td>
      <td>112396081</td>
      <td>AAPL</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2006-01-06</td>
      <td>10.75</td>
      <td>10.96</td>
      <td>10.65</td>
      <td>10.90</td>
      <td>176139334</td>
      <td>AAPL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2006-01-09</td>
      <td>10.96</td>
      <td>11.03</td>
      <td>10.82</td>
      <td>10.86</td>
      <td>168861224</td>
      <td>AAPL</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Vamos a cambiar el índice de los datos. Tomaremos la fecha como indice: <em>df.index</em>. Los datos se reordenan para invertir la tabla, debido a que los datos contienen las observaciones más recientes en la parte superior de la tabla.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#creating dataframe with date and the target variable</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<span class="c1"># df = df.sort_index(ascending=True, axis=0)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">]])</span>
<span class="c1">#</span>
<span class="c1">#setting index</span>
<span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Date</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Close</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-03</th>
      <td>10.68</td>
    </tr>
    <tr>
      <th>2006-01-04</th>
      <td>10.71</td>
    </tr>
    <tr>
      <th>2006-01-05</th>
      <td>10.63</td>
    </tr>
    <tr>
      <th>2006-01-06</th>
      <td>10.90</td>
    </tr>
    <tr>
      <th>2006-01-09</th>
      <td>10.86</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Visualizamos los datos y definimos el conjunto de entrenamiento y el conjunto de validación</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot</span>
<span class="n">len_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="c1"># 100%  = 3019</span>
<span class="n">len_train</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">len_data</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># 80%  = 2415</span>
<span class="n">len_test</span> <span class="o">=</span> <span class="n">len_data</span><span class="o">-</span> <span class="n">len_train</span> <span class="c1"># 20% = 604</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">len_data</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">len_train</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">len_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3019 = 2415 + 604
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">len_train</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Conjunto de entrenamiento (Training set): </span><span class="si">{}</span><span class="s1"> puntos (80%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">len_train</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">][</span><span class="n">len_train</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Conjunto de prueba (test set): </span><span class="si">{}</span><span class="s1"> puntos (20%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">len_test</span><span class="p">))</span> <span class="c1">#248 data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Apple: Historia del precio la acción al cierre (Close)&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_15_0.png" src="../../_images/Taller_Series_de_Tiempo_15_0.png" />
</div>
</div>
</section>
</section>
<section id="span-style-color-blue-preparacion-de-los-datos-para-el-entrenamiento-de-la-red-lstm-span">
<h2><span style="color:blue">Preparación de los datos para el entrenamiento de la red LSTM</span><a class="headerlink" href="#span-style-color-blue-preparacion-de-los-datos-para-el-entrenamiento-de-la-red-lstm-span" title="Permalink to this headline">#</a></h2>
<p>Para evitar problemas con las tendencias y para mejorar la estimación (entrenamiento) los datos se van a transformar a la escala <span class="math notranslate nohighlight">\([0,1]\)</span>. Para las predicciones se utiliza la transformación inversa.</p>
<p>Primero extrae los valores y se crea el  objeto MinMaxScaler</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># llamamos la función en específico</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span> <span class="c1">#to_numpy()</span>


<span class="c1"># creamos el escalador para estandarizar los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="span-style-color-blue-crea-datos-de-entrenamiento-span">
<h2><span style="color:blue">Crea datos de entrenamiento</span><a class="headerlink" href="#span-style-color-blue-crea-datos-de-entrenamiento-span" title="Permalink to this headline">#</a></h2>
<p>La red LSTM tendrá como entrada “time_step” datos consecutivos, y como salida 1 dato (la predicción a
partir de esos “time_step” datos se hace para los siguentes días). Se conformará de esta forma el set de entrenamiento</p>
<ol class="simple">
<li><p>Número de datos consecutivos para entrenamiento: time_step = 60.</p></li>
<li><p>Días a predecir: days = 1</p></li>
</ol>
<section id="span-style-color-blue-funcion-para-crear-los-datos-entrenamiento-span">
<h3><span style="color:blue">Función para crear los datos entrenamiento</span><a class="headerlink" href="#span-style-color-blue-funcion-para-crear-los-datos-entrenamiento-span" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multipaso_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">end_index</span><span class="p">,</span> <span class="n">history_size</span><span class="p">,</span>
                      <span class="n">target_size</span><span class="p">,</span>  <span class="n">single_step</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; dataset: conjunto de datos para las secuencias de entrada</span>
<span class="sd">        target:  conjunto de datos para las secuencias de salida</span>
<span class="sd">        start_index: índice inicial de donde empezar a tomar los datos</span>
<span class="sd">        end_index: índice final para tomar los datos. None para tomarlos todos</span>
<span class="sd">        history_size: tamaño de la venytana para crear las secuencias</span>
<span class="sd">        target_size: dentro de cuántas observaciones futuras desea pronosticar</span>
<span class="sd">        single_step: Predecir solamente un valor futuro (=True),</span>
<span class="sd">                     o predecir todos los valores hasta target_size(=False)</span>
<span class="sd">    &#39;&#39;&#39;</span>  
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">start_index</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="n">history_size</span>
    <span class="k">if</span> <span class="n">end_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="n">target_size</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">end_index</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">history_size</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">single_step</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">target_size</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">target_size</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Se coloca una semilla para gerantizar reproductibidad</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># hiperparámetros para crear las secuencias</span>
<span class="c1">#</span>
<span class="c1"># tamaño de pasos a futuro</span>
<span class="n">future_target</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># tamaño secuencias de entrada</span>
<span class="n">past_history</span> <span class="o">=</span> <span class="mi">60</span> 

<span class="n">TRAIN_SPLIT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">len_data</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1">#2415: nuḿer0 de datos entreno</span>

<span class="c1"># Crea los datos</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">multipaso_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                 <span class="n">TRAIN_SPLIT</span><span class="p">,</span> <span class="n">past_history</span><span class="p">,</span>
                                                 <span class="n">future_target</span><span class="p">,</span> <span class="n">single_step</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">multipaso_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">TRAIN_SPLIT</span><span class="p">,</span>
                                                 <span class="kc">None</span><span class="p">,</span> <span class="n">past_history</span><span class="p">,</span>
                                                 <span class="n">future_target</span><span class="p">,</span> <span class="n">single_step</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TRAIN_SPLIT</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2415
(2355, 60)
(2355,)
(543, 60)
(543,)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="span-style-color-blue-crea-el-modelo-lstm-span">
<h2><span style="color:blue">Crea el modelo LSTM</span><a class="headerlink" href="#span-style-color-blue-crea-el-modelo-lstm-span" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># unidades de salida de las capas LSTM</span>
<span class="c1">#</span>
<span class="n">units</span> <span class="o">=</span> <span class="mi">64</span>
<span class="c1">#</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LSTM_1&quot;</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LSTM_2&quot;</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">future_target</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Output&quot;</span><span class="p">)])</span>

<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential&quot;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>_________________________________________________________________
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Layer (type)                Output Shape              Param #   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=================================================================
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> LSTM_1 (LSTM)               (None, 60, 64)            16896     
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> LSTM_2 (LSTM)               (None, 64)                33024     
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Output (Dense)              (None, 1)                 65        
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=================================================================
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total params: 49,985
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Trainable params: 49,985
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Non-trainable params: 0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>_________________________________________________________________
</pre></div>
</div>
</div>
</div>
</section>
<section id="span-style-color-blue-compila-span">
<h2><span style="color:blue">Compila</span><a class="headerlink" href="#span-style-color-blue-compila-span" title="Permalink to this headline">#</a></h2>
<p>Se usará el optimizador Adam y la función de pérdida MSE</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="span-style-color-blue-entrena-el-modelo-span">
<h2><span style="color:blue"> Entrena el modelo</span><a class="headerlink" href="#span-style-color-blue-entrena-el-modelo-span" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span>
                    <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                    <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 1/67 [..............................] - ETA: 7:37 - loss: 0.0732
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 2/67 [..............................] - ETA: 4s - loss: 0.0576  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 3/67 [&gt;.............................] - ETA: 4s - loss: 0.0556
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 4/67 [&gt;.............................] - ETA: 4s - loss: 0.0493
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 5/67 [=&gt;............................] - ETA: 4s - loss: 0.0447
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 6/67 [=&gt;............................] - ETA: 4s - loss: 0.0387
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 7/67 [==&gt;...........................] - ETA: 4s - loss: 0.0338
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 9/67 [===&gt;..........................] - ETA: 4s - loss: 0.0284
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
10/67 [===&gt;..........................] - ETA: 3s - loss: 0.0267
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
11/67 [===&gt;..........................] - ETA: 3s - loss: 0.0249
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/67 [====&gt;.........................] - ETA: 3s - loss: 0.0231
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
13/67 [====&gt;.........................] - ETA: 3s - loss: 0.0216
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
14/67 [=====&gt;........................] - ETA: 3s - loss: 0.0203
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
15/67 [=====&gt;........................] - ETA: 3s - loss: 0.0192
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
16/67 [======&gt;.......................] - ETA: 3s - loss: 0.0183
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
17/67 [======&gt;.......................] - ETA: 3s - loss: 0.0174
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
18/67 [=======&gt;......................] - ETA: 3s - loss: 0.0167
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
19/67 [=======&gt;......................] - ETA: 3s - loss: 0.0159
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
20/67 [=======&gt;......................] - ETA: 3s - loss: 0.0152
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
21/67 [========&gt;.....................] - ETA: 3s - loss: 0.0146
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
22/67 [========&gt;.....................] - ETA: 3s - loss: 0.0140
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
23/67 [=========&gt;....................] - ETA: 3s - loss: 0.0135
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
24/67 [=========&gt;....................] - ETA: 3s - loss: 0.0129
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
25/67 [==========&gt;...................] - ETA: 2s - loss: 0.0124
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
26/67 [==========&gt;...................] - ETA: 2s - loss: 0.0120
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
27/67 [===========&gt;..................] - ETA: 2s - loss: 0.0116
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
28/67 [===========&gt;..................] - ETA: 2s - loss: 0.0112
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
29/67 [===========&gt;..................] - ETA: 2s - loss: 0.0108
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
30/67 [============&gt;.................] - ETA: 2s - loss: 0.0105
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
31/67 [============&gt;.................] - ETA: 2s - loss: 0.0102
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
32/67 [=============&gt;................] - ETA: 2s - loss: 0.0099
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
33/67 [=============&gt;................] - ETA: 2s - loss: 0.0096
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
34/67 [==============&gt;...............] - ETA: 2s - loss: 0.0093
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
35/67 [==============&gt;...............] - ETA: 2s - loss: 0.0091
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
36/67 [===============&gt;..............] - ETA: 2s - loss: 0.0089
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
37/67 [===============&gt;..............] - ETA: 2s - loss: 0.0086
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
39/67 [================&gt;.............] - ETA: 1s - loss: 0.0082
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
40/67 [================&gt;.............] - ETA: 1s - loss: 0.0080
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
41/67 [=================&gt;............] - ETA: 1s - loss: 0.0078
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
42/67 [=================&gt;............] - ETA: 1s - loss: 0.0076
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
43/67 [==================&gt;...........] - ETA: 1s - loss: 0.0075
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
44/67 [==================&gt;...........] - ETA: 1s - loss: 0.0073
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
45/67 [===================&gt;..........] - ETA: 1s - loss: 0.0072
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
46/67 [===================&gt;..........] - ETA: 1s - loss: 0.0070
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
47/67 [====================&gt;.........] - ETA: 1s - loss: 0.0069
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
49/67 [====================&gt;.........] - ETA: 1s - loss: 0.0066
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
50/67 [=====================&gt;........] - ETA: 1s - loss: 0.0065
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
52/67 [======================&gt;.......] - ETA: 0s - loss: 0.0063
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
54/67 [=======================&gt;......] - ETA: 0s - loss: 0.0060
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
55/67 [=======================&gt;......] - ETA: 0s - loss: 0.0059
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
57/67 [========================&gt;.....] - ETA: 0s - loss: 0.0057
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
58/67 [========================&gt;.....] - ETA: 0s - loss: 0.0056
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
59/67 [=========================&gt;....] - ETA: 0s - loss: 0.0055
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
60/67 [=========================&gt;....] - ETA: 0s - loss: 0.0055
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
61/67 [==========================&gt;...] - ETA: 0s - loss: 0.0054
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
62/67 [==========================&gt;...] - ETA: 0s - loss: 0.0053
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
63/67 [===========================&gt;..] - ETA: 0s - loss: 0.0052
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
65/67 [============================&gt;.] - ETA: 0s - loss: 0.0051
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
66/67 [============================&gt;.] - ETA: 0s - loss: 0.0050
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
67/67 [==============================] - ETA: 0s - loss: 0.0050
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
67/67 [==============================] - 13s 93ms/step - loss: 0.0050 - val_loss: 5.8563e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 2/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 1/67 [..............................] - ETA: 4s - loss: 2.7854e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 2/67 [..............................] - ETA: 4s - loss: 3.3344e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 3/67 [&gt;.............................] - ETA: 4s - loss: 3.9820e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 4/67 [&gt;.............................] - ETA: 3s - loss: 3.4119e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 5/67 [=&gt;............................] - ETA: 3s - loss: 3.3381e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 6/67 [=&gt;............................] - ETA: 3s - loss: 3.0598e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 7/67 [==&gt;...........................] - ETA: 3s - loss: 2.9499e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 8/67 [==&gt;...........................] - ETA: 3s - loss: 2.8460e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 9/67 [===&gt;..........................] - ETA: 3s - loss: 2.8563e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
10/67 [===&gt;..........................] - ETA: 3s - loss: 2.7663e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
11/67 [===&gt;..........................] - ETA: 3s - loss: 2.7968e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/67 [====&gt;.........................] - ETA: 3s - loss: 2.9625e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
13/67 [====&gt;.........................] - ETA: 3s - loss: 2.9232e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
14/67 [=====&gt;........................] - ETA: 3s - loss: 2.8955e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
15/67 [=====&gt;........................] - ETA: 3s - loss: 2.8624e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
16/67 [======&gt;.......................] - ETA: 3s - loss: 2.7982e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
17/67 [======&gt;.......................] - ETA: 3s - loss: 2.7202e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
18/67 [=======&gt;......................] - ETA: 3s - loss: 2.7201e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
19/67 [=======&gt;......................] - ETA: 3s - loss: 2.7137e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
20/67 [=======&gt;......................] - ETA: 3s - loss: 2.7785e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
21/67 [========&gt;.....................] - ETA: 3s - loss: 2.7110e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
22/67 [========&gt;.....................] - ETA: 3s - loss: 2.7081e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
23/67 [=========&gt;....................] - ETA: 3s - loss: 2.7005e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
24/67 [=========&gt;....................] - ETA: 3s - loss: 2.6652e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
25/67 [==========&gt;...................] - ETA: 3s - loss: 2.6036e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
26/67 [==========&gt;...................] - ETA: 2s - loss: 2.6535e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
27/67 [===========&gt;..................] - ETA: 2s - loss: 2.6688e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
28/67 [===========&gt;..................] - ETA: 2s - loss: 2.6357e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
29/67 [===========&gt;..................] - ETA: 2s - loss: 2.6047e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
31/67 [============&gt;.................] - ETA: 2s - loss: 2.5228e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
32/67 [=============&gt;................] - ETA: 2s - loss: 2.5321e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
34/67 [==============&gt;...............] - ETA: 2s - loss: 2.4967e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
35/67 [==============&gt;...............] - ETA: 2s - loss: 2.4999e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
36/67 [===============&gt;..............] - ETA: 2s - loss: 2.4851e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
37/67 [===============&gt;..............] - ETA: 2s - loss: 2.4600e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
38/67 [================&gt;.............] - ETA: 1s - loss: 2.4384e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
39/67 [================&gt;.............] - ETA: 1s - loss: 2.4511e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
40/67 [================&gt;.............] - ETA: 1s - loss: 2.4427e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
41/67 [=================&gt;............] - ETA: 1s - loss: 2.4730e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
42/67 [=================&gt;............] - ETA: 1s - loss: 2.5030e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
43/67 [==================&gt;...........] - ETA: 1s - loss: 2.4868e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
44/67 [==================&gt;...........] - ETA: 1s - loss: 2.4609e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
45/67 [===================&gt;..........] - ETA: 1s - loss: 2.4500e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
46/67 [===================&gt;..........] - ETA: 1s - loss: 2.4212e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
47/67 [====================&gt;.........] - ETA: 1s - loss: 2.3977e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
48/67 [====================&gt;.........] - ETA: 1s - loss: 2.4291e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
49/67 [====================&gt;.........] - ETA: 1s - loss: 2.4400e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
51/67 [=====================&gt;........] - ETA: 1s - loss: 2.3905e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
53/67 [======================&gt;.......] - ETA: 0s - loss: 2.4027e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
54/67 [=======================&gt;......] - ETA: 0s - loss: 2.3942e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
55/67 [=======================&gt;......] - ETA: 0s - loss: 2.4079e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
56/67 [========================&gt;.....] - ETA: 0s - loss: 2.4036e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
57/67 [========================&gt;.....] - ETA: 0s - loss: 2.3814e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
58/67 [========================&gt;.....] - ETA: 0s - loss: 2.3593e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
59/67 [=========================&gt;....] - ETA: 0s - loss: 2.3541e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
60/67 [=========================&gt;....] - ETA: 0s - loss: 2.3539e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
61/67 [==========================&gt;...] - ETA: 0s - loss: 2.3383e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
62/67 [==========================&gt;...] - ETA: 0s - loss: 2.3562e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
63/67 [===========================&gt;..] - ETA: 0s - loss: 2.3670e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
64/67 [===========================&gt;..] - ETA: 0s - loss: 2.3474e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
65/67 [============================&gt;.] - ETA: 0s - loss: 2.3472e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
66/67 [============================&gt;.] - ETA: 0s - loss: 2.3436e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
67/67 [==============================] - ETA: 0s - loss: 2.3541e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
67/67 [==============================] - 5s 70ms/step - loss: 2.3541e-04 - val_loss: 6.8017e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 3/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 1/67 [..............................] - ETA: 5s - loss: 2.1611e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 2/67 [..............................] - ETA: 4s - loss: 3.2585e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 3/67 [&gt;.............................] - ETA: 4s - loss: 3.5725e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 4/67 [&gt;.............................] - ETA: 4s - loss: 3.6332e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 5/67 [=&gt;............................] - ETA: 4s - loss: 3.4070e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 6/67 [=&gt;............................] - ETA: 4s - loss: 3.1917e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 7/67 [==&gt;...........................] - ETA: 4s - loss: 2.9115e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 8/67 [==&gt;...........................] - ETA: 4s - loss: 2.9299e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 9/67 [===&gt;..........................] - ETA: 4s - loss: 2.8203e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
10/67 [===&gt;..........................] - ETA: 3s - loss: 2.7113e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
11/67 [===&gt;..........................] - ETA: 3s - loss: 2.6478e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/67 [====&gt;.........................] - ETA: 3s - loss: 2.5576e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
13/67 [====&gt;.........................] - ETA: 3s - loss: 2.4444e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
14/67 [=====&gt;........................] - ETA: 3s - loss: 2.3616e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
15/67 [=====&gt;........................] - ETA: 3s - loss: 2.4566e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
16/67 [======&gt;.......................] - ETA: 3s - loss: 2.4246e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
17/67 [======&gt;.......................] - ETA: 3s - loss: 2.4079e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
18/67 [=======&gt;......................] - ETA: 3s - loss: 2.3642e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
19/67 [=======&gt;......................] - ETA: 3s - loss: 2.3314e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
21/67 [========&gt;.....................] - ETA: 3s - loss: 2.3212e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
23/67 [=========&gt;....................] - ETA: 2s - loss: 2.3259e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
24/67 [=========&gt;....................] - ETA: 2s - loss: 2.3446e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
25/67 [==========&gt;...................] - ETA: 2s - loss: 2.3062e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
26/67 [==========&gt;...................] - ETA: 2s - loss: 2.2574e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
27/67 [===========&gt;..................] - ETA: 2s - loss: 2.2039e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
29/67 [===========&gt;..................] - ETA: 2s - loss: 2.2640e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
30/67 [============&gt;.................] - ETA: 2s - loss: 2.2384e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
32/67 [=============&gt;................] - ETA: 2s - loss: 2.2136e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
34/67 [==============&gt;...............] - ETA: 2s - loss: 2.1796e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
35/67 [==============&gt;...............] - ETA: 1s - loss: 2.1613e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
37/67 [===============&gt;..............] - ETA: 1s - loss: 2.1689e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
39/67 [================&gt;.............] - ETA: 1s - loss: 2.1542e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
40/67 [================&gt;.............] - ETA: 1s - loss: 2.1521e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
42/67 [=================&gt;............] - ETA: 1s - loss: 2.1666e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
44/67 [==================&gt;...........] - ETA: 1s - loss: 2.1592e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
45/67 [===================&gt;..........] - ETA: 1s - loss: 2.1739e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
47/67 [====================&gt;.........] - ETA: 1s - loss: 2.1761e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
49/67 [====================&gt;.........] - ETA: 1s - loss: 2.1840e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
50/67 [=====================&gt;........] - ETA: 1s - loss: 2.1957e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
51/67 [=====================&gt;........] - ETA: 0s - loss: 2.2077e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
52/67 [======================&gt;.......] - ETA: 0s - loss: 2.1990e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
53/67 [======================&gt;.......] - ETA: 0s - loss: 2.1953e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
54/67 [=======================&gt;......] - ETA: 0s - loss: 2.2347e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
55/67 [=======================&gt;......] - ETA: 0s - loss: 2.2347e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
56/67 [========================&gt;.....] - ETA: 0s - loss: 2.2366e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
57/67 [========================&gt;.....] - ETA: 0s - loss: 2.2346e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
58/67 [========================&gt;.....] - ETA: 0s - loss: 2.2353e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
59/67 [=========================&gt;....] - ETA: 0s - loss: 2.2347e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
60/67 [=========================&gt;....] - ETA: 0s - loss: 2.2391e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
61/67 [==========================&gt;...] - ETA: 0s - loss: 2.2441e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
62/67 [==========================&gt;...] - ETA: 0s - loss: 2.2389e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
63/67 [===========================&gt;..] - ETA: 0s - loss: 2.2247e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
64/67 [===========================&gt;..] - ETA: 0s - loss: 2.2261e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
65/67 [============================&gt;.] - ETA: 0s - loss: 2.2179e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
66/67 [============================&gt;.] - ETA: 0s - loss: 2.2172e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
67/67 [==============================] - 4s 67ms/step - loss: 2.2131e-04 - val_loss: 5.4451e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 4/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 1/67 [..............................] - ETA: 4s - loss: 1.7606e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 2/67 [..............................] - ETA: 5s - loss: 1.5147e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 3/67 [&gt;.............................] - ETA: 5s - loss: 1.9139e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 4/67 [&gt;.............................] - ETA: 5s - loss: 1.9409e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 5/67 [=&gt;............................] - ETA: 5s - loss: 2.0461e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 6/67 [=&gt;............................] - ETA: 4s - loss: 1.9611e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 7/67 [==&gt;...........................] - ETA: 4s - loss: 1.9115e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 8/67 [==&gt;...........................] - ETA: 4s - loss: 1.9049e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 9/67 [===&gt;..........................] - ETA: 4s - loss: 2.0038e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
10/67 [===&gt;..........................] - ETA: 4s - loss: 2.1203e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
11/67 [===&gt;..........................] - ETA: 3s - loss: 2.0716e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/67 [====&gt;.........................] - ETA: 4s - loss: 2.0236e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
13/67 [====&gt;.........................] - ETA: 4s - loss: 1.9266e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
14/67 [=====&gt;........................] - ETA: 4s - loss: 2.0222e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
15/67 [=====&gt;........................] - ETA: 3s - loss: 2.0054e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
16/67 [======&gt;.......................] - ETA: 3s - loss: 2.0451e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
17/67 [======&gt;.......................] - ETA: 3s - loss: 1.9893e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
18/67 [=======&gt;......................] - ETA: 3s - loss: 1.9910e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
19/67 [=======&gt;......................] - ETA: 3s - loss: 1.9761e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
20/67 [=======&gt;......................] - ETA: 3s - loss: 1.9789e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
21/67 [========&gt;.....................] - ETA: 3s - loss: 1.9644e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
22/67 [========&gt;.....................] - ETA: 3s - loss: 1.9360e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
23/67 [=========&gt;....................] - ETA: 3s - loss: 1.9483e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
24/67 [=========&gt;....................] - ETA: 3s - loss: 1.9114e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
25/67 [==========&gt;...................] - ETA: 3s - loss: 1.8976e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
26/67 [==========&gt;...................] - ETA: 2s - loss: 1.8495e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
27/67 [===========&gt;..................] - ETA: 2s - loss: 1.8263e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
28/67 [===========&gt;..................] - ETA: 2s - loss: 1.8502e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
29/67 [===========&gt;..................] - ETA: 2s - loss: 1.8431e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
30/67 [============&gt;.................] - ETA: 2s - loss: 1.8691e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
31/67 [============&gt;.................] - ETA: 2s - loss: 1.8886e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
32/67 [=============&gt;................] - ETA: 2s - loss: 1.9450e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
33/67 [=============&gt;................] - ETA: 2s - loss: 1.9676e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
34/67 [==============&gt;...............] - ETA: 2s - loss: 1.9952e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
35/67 [==============&gt;...............] - ETA: 2s - loss: 1.9838e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
36/67 [===============&gt;..............] - ETA: 2s - loss: 1.9565e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
37/67 [===============&gt;..............] - ETA: 2s - loss: 1.9369e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
38/67 [================&gt;.............] - ETA: 1s - loss: 1.9108e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
39/67 [================&gt;.............] - ETA: 1s - loss: 1.9163e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
40/67 [================&gt;.............] - ETA: 1s - loss: 1.9040e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
41/67 [=================&gt;............] - ETA: 1s - loss: 1.9089e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
42/67 [=================&gt;............] - ETA: 1s - loss: 1.8903e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
43/67 [==================&gt;...........] - ETA: 1s - loss: 1.8831e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
44/67 [==================&gt;...........] - ETA: 1s - loss: 1.9147e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
45/67 [===================&gt;..........] - ETA: 1s - loss: 1.9208e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
46/67 [===================&gt;..........] - ETA: 1s - loss: 1.9216e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
47/67 [====================&gt;.........] - ETA: 1s - loss: 1.9162e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
48/67 [====================&gt;.........] - ETA: 1s - loss: 1.9233e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
49/67 [====================&gt;.........] - ETA: 1s - loss: 1.9226e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
50/67 [=====================&gt;........] - ETA: 1s - loss: 1.9482e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
51/67 [=====================&gt;........] - ETA: 1s - loss: 1.9525e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
52/67 [======================&gt;.......] - ETA: 1s - loss: 1.9697e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
53/67 [======================&gt;.......] - ETA: 0s - loss: 1.9898e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
54/67 [=======================&gt;......] - ETA: 0s - loss: 2.0074e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
55/67 [=======================&gt;......] - ETA: 0s - loss: 2.0012e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
56/67 [========================&gt;.....] - ETA: 0s - loss: 1.9895e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
57/67 [========================&gt;.....] - ETA: 0s - loss: 1.9916e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
58/67 [========================&gt;.....] - ETA: 0s - loss: 2.0135e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
59/67 [=========================&gt;....] - ETA: 0s - loss: 2.0274e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
60/67 [=========================&gt;....] - ETA: 0s - loss: 2.0220e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
61/67 [==========================&gt;...] - ETA: 0s - loss: 2.0089e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
62/67 [==========================&gt;...] - ETA: 0s - loss: 2.0089e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
63/67 [===========================&gt;..] - ETA: 0s - loss: 2.0175e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
64/67 [===========================&gt;..] - ETA: 0s - loss: 2.0149e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
65/67 [============================&gt;.] - ETA: 0s - loss: 2.0026e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
66/67 [============================&gt;.] - ETA: 0s - loss: 1.9993e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
67/67 [==============================] - ETA: 0s - loss: 2.0005e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
67/67 [==============================] - 5s 70ms/step - loss: 2.0005e-04 - val_loss: 0.0013
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 5/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 1/67 [..............................] - ETA: 4s - loss: 4.3402e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 2/67 [..............................] - ETA: 3s - loss: 4.5231e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 3/67 [&gt;.............................] - ETA: 3s - loss: 3.6889e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 4/67 [&gt;.............................] - ETA: 3s - loss: 3.0417e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 5/67 [=&gt;............................] - ETA: 3s - loss: 3.0978e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 6/67 [=&gt;............................] - ETA: 3s - loss: 3.3836e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 7/67 [==&gt;...........................] - ETA: 3s - loss: 3.6838e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 9/67 [===&gt;..........................] - ETA: 3s - loss: 3.4867e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
10/67 [===&gt;..........................] - ETA: 3s - loss: 3.5167e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
11/67 [===&gt;..........................] - ETA: 3s - loss: 3.4010e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/67 [====&gt;.........................] - ETA: 3s - loss: 3.1795e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
13/67 [====&gt;.........................] - ETA: 3s - loss: 3.0632e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
14/67 [=====&gt;........................] - ETA: 3s - loss: 2.9444e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
15/67 [=====&gt;........................] - ETA: 3s - loss: 2.8632e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
16/67 [======&gt;.......................] - ETA: 3s - loss: 2.8412e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
17/67 [======&gt;.......................] - ETA: 3s - loss: 2.7688e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
18/67 [=======&gt;......................] - ETA: 3s - loss: 2.8608e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
19/67 [=======&gt;......................] - ETA: 3s - loss: 2.8118e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
20/67 [=======&gt;......................] - ETA: 3s - loss: 2.7982e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
21/67 [========&gt;.....................] - ETA: 3s - loss: 2.9131e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
22/67 [========&gt;.....................] - ETA: 2s - loss: 2.9336e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
23/67 [=========&gt;....................] - ETA: 2s - loss: 2.8905e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
24/67 [=========&gt;....................] - ETA: 2s - loss: 2.8417e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
25/67 [==========&gt;...................] - ETA: 2s - loss: 2.8275e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
26/67 [==========&gt;...................] - ETA: 2s - loss: 2.8209e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
27/67 [===========&gt;..................] - ETA: 2s - loss: 2.7661e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
28/67 [===========&gt;..................] - ETA: 2s - loss: 2.7831e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
29/67 [===========&gt;..................] - ETA: 2s - loss: 2.7774e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
30/67 [============&gt;.................] - ETA: 2s - loss: 2.7776e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
31/67 [============&gt;.................] - ETA: 2s - loss: 2.7161e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
32/67 [=============&gt;................] - ETA: 2s - loss: 2.6910e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
33/67 [=============&gt;................] - ETA: 2s - loss: 2.6805e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
34/67 [==============&gt;...............] - ETA: 2s - loss: 2.6760e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
35/67 [==============&gt;...............] - ETA: 2s - loss: 2.6263e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
36/67 [===============&gt;..............] - ETA: 2s - loss: 2.5993e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
37/67 [===============&gt;..............] - ETA: 1s - loss: 2.5597e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
38/67 [================&gt;.............] - ETA: 1s - loss: 2.5416e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
39/67 [================&gt;.............] - ETA: 1s - loss: 2.5556e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
40/67 [================&gt;.............] - ETA: 1s - loss: 2.5359e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
41/67 [=================&gt;............] - ETA: 1s - loss: 2.5421e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
42/67 [=================&gt;............] - ETA: 1s - loss: 2.5312e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
43/67 [==================&gt;...........] - ETA: 1s - loss: 2.5099e-04
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
44/67 [==================&gt;...........] - ETA: 1s - loss: 2.4806e-04
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_33_0.png" src="../../_images/Taller_Series_de_Tiempo_33_0.png" />
</div>
</div>
</section>
<section id="span-style-color-blue-predicciones-span">
<h2><span style="color:blue">Predicciones</span><a class="headerlink" href="#span-style-color-blue-predicciones-span" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># predictions</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1"># prediction = scaler.inverse_transform(prediction)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17/17 [==============================] - 2s 34ms/step
</pre></div>
</div>
</div>
</div>
<section id="span-style-color-blue-funcion-para-graficar-predicciones-span">
<h3><span style="color:blue">Función para graficar predicciones</span><a class="headerlink" href="#span-style-color-blue-funcion-para-graficar-predicciones-span" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">prediccion</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Valor real de la acción&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediccion</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicción de la acción&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">prediccion</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prediccion</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Valor de la acción&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred</span> <span class="o">=</span><span class="mi">0</span>
<span class="n">X_test_p</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">pred</span><span class="p">,:]</span>
<span class="n">y_test_p</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">pred</span><span class="p">,:]</span>
<span class="n">pred_p</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">pred</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)),</span> <span class="n">X_test_p</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;historia&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test_p</span><span class="p">)),</span> <span class="n">y_test_p</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;verdadero&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test_p</span><span class="p">)),</span> <span class="n">pred_p</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;predicción&quot;</span><span class="p">)</span>
<span class="c1">#plt.ylabel(&#39;Valor&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time Step&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Apple: Historia del precio la acción al cierre. Escala (0,1)&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">c:\Users\User\OneDrive\Documentos\Libro-Programacion\TensorFlow\Cuadernos\Taller_Series_de_Tiempo.ipynb Celda 40</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
      <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;vscode-notebook-cell:/c%3A/Users/User/OneDrive/Documentos/Libro-Programacion/TensorFlow/Cuadernos/Taller_Series_de_Tiempo.ipynb#ch0000051?line=0&#39;</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)),</span> <span class="n">X_test_p</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;historia&quot;</span><span class="p">)</span>
<span class="o">----&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;vscode-notebook-cell:/c%3A/Users/User/OneDrive/Documentos/Libro-Programacion/TensorFlow/Cuadernos/Taller_Series_de_Tiempo.ipynb#ch0000051?line=1&#39;</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test_p</span><span class="p">)),</span> <span class="n">y_test_p</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;verdadero&quot;</span><span class="p">)</span>
      <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;vscode-notebook-cell:/c%3A/Users/User/OneDrive/Documentos/Libro-Programacion/TensorFlow/Cuadernos/Taller_Series_de_Tiempo.ipynb#ch0000051?line=2&#39;</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test_p</span><span class="p">)),</span> <span class="n">pred_p</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;predicción&quot;</span><span class="p">)</span>
      <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;vscode-notebook-cell:/c%3A/Users/User/OneDrive/Documentos/Libro-Programacion/TensorFlow/Cuadernos/Taller_Series_de_Tiempo.ipynb#ch0000051?line=3&#39;</span><span class="o">&gt;</span><span class="mi">4</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="c1">#plt.ylabel(&#39;Valor&#39;)</span>

<span class="ne">TypeError</span>: object of type &#39;numpy.float64&#39; has no len()
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_39_1.png" src="../../_images/Taller_Series_de_Tiempo_39_1.png" />
</div>
</div>
</section>
</section>
<section id="span-style-color-blue-caso-multipaso-span">
<h2><span style="color:blue">Caso multipaso</span><a class="headerlink" href="#span-style-color-blue-caso-multipaso-span" title="Permalink to this headline">#</a></h2>
<p>Se crean ahora nuevas versiones de datos cuyos labels son una serie de datos completo. De esa forma se hará una predicción en más días a futuro</p>
<p>Repetimos el proceso completo con algunos cambios</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># hiperparámetros para crear las secuencias</span>
<span class="c1">#</span>
<span class="c1"># tamaño de pasos a futuro</span>
<span class="n">future_target</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># tamaño secuencias de entrada</span>
<span class="n">past_history</span> <span class="o">=</span> <span class="mi">60</span> 

<span class="n">TRAIN_SPLIT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">len_data</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1">#2415: nuḿer0 de datos entreno</span>

<span class="c1"># Crea los datos</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">multipaso_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                 <span class="n">TRAIN_SPLIT</span><span class="p">,</span> <span class="n">past_history</span><span class="p">,</span>
                                                 <span class="n">future_target</span><span class="p">)</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">multipaso_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">TRAIN_SPLIT</span><span class="p">,</span>
                                                 <span class="kc">None</span><span class="p">,</span> <span class="n">past_history</span><span class="p">,</span>
                                                 <span class="n">future_target</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TRAIN_SPLIT</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2415
(2355, 60)
(2355, 10)
(534, 60)
(534, 10)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># unidades de salida de las capas LSTM</span>
<span class="c1">#</span>
<span class="n">units</span> <span class="o">=</span> <span class="mi">64</span>
<span class="c1">#</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LSTM_1&quot;</span><span class="p">),</span>
    
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LSTM_2&quot;</span><span class="p">),</span>
    
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">future_target</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Output&quot;</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1">#tf.keras.layers.Dropout()</span>

<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential_1&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 LSTM_1 (LSTM)               (None, 60, 64)            16896     
                                                                 
 LSTM_2 (LSTM)               (None, 64)                33024     
                                                                 
 Output (Dense)              (None, 10)                650       
                                                                 
=================================================================
Total params: 50,570
Trainable params: 50,570
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span>
                    <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                    <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
67/67 [==============================] - 4s 21ms/step - loss: 0.0055 - val_loss: 0.0011
Epoch 2/20
67/67 [==============================] - 0s 7ms/step - loss: 3.7474e-04 - val_loss: 0.0013
Epoch 3/20
67/67 [==============================] - 1s 8ms/step - loss: 3.8046e-04 - val_loss: 0.0037
Epoch 4/20
67/67 [==============================] - 1s 9ms/step - loss: 3.2330e-04 - val_loss: 0.0010
Epoch 5/20
67/67 [==============================] - 1s 8ms/step - loss: 3.2600e-04 - val_loss: 0.0031
Epoch 6/20
67/67 [==============================] - 1s 8ms/step - loss: 3.1790e-04 - val_loss: 0.0041
Epoch 7/20
67/67 [==============================] - 0s 7ms/step - loss: 3.2076e-04 - val_loss: 0.0019
Epoch 8/20
67/67 [==============================] - 1s 8ms/step - loss: 2.7540e-04 - val_loss: 0.0023
Epoch 9/20
67/67 [==============================] - 0s 7ms/step - loss: 2.7933e-04 - val_loss: 0.0019
Epoch 10/20
67/67 [==============================] - 0s 7ms/step - loss: 2.9928e-04 - val_loss: 0.0016
Epoch 11/20
67/67 [==============================] - 0s 7ms/step - loss: 3.1742e-04 - val_loss: 0.0010
Epoch 12/20
67/67 [==============================] - 1s 9ms/step - loss: 2.8648e-04 - val_loss: 8.4149e-04
Epoch 13/20
67/67 [==============================] - 1s 8ms/step - loss: 2.8563e-04 - val_loss: 8.2047e-04
Epoch 14/20
67/67 [==============================] - 1s 8ms/step - loss: 2.4504e-04 - val_loss: 0.0013
Epoch 15/20
67/67 [==============================] - 1s 8ms/step - loss: 2.5297e-04 - val_loss: 8.9034e-04
Epoch 16/20
67/67 [==============================] - 0s 7ms/step - loss: 2.5203e-04 - val_loss: 7.0489e-04
Epoch 17/20
67/67 [==============================] - 0s 7ms/step - loss: 2.8989e-04 - val_loss: 0.0011
Epoch 18/20
67/67 [==============================] - 0s 7ms/step - loss: 2.7281e-04 - val_loss: 7.8934e-04
Epoch 19/20
67/67 [==============================] - 1s 8ms/step - loss: 2.6734e-04 - val_loss: 0.0021
Epoch 20/20
67/67 [==============================] - 1s 8ms/step - loss: 2.5051e-04 - val_loss: 7.5283e-04
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_46_0.png" src="../../_images/Taller_Series_de_Tiempo_46_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># predictions</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1"># prediction = scaler.inverse_transform(prediction)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred</span> <span class="o">=</span><span class="mi">0</span>
<span class="n">X_test_p</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">pred</span><span class="p">,:]</span>
<span class="n">y_test_p</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">pred</span><span class="p">,:]</span>
<span class="n">pred_p</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">pred</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)),</span> <span class="n">X_test_p</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;historia&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test_p</span><span class="p">)),</span> <span class="n">y_test_p</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;verdadero&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test_p</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test_p</span><span class="p">)),</span> <span class="n">pred_p</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;predicción&quot;</span><span class="p">)</span>
<span class="c1">#plt.ylabel(&#39;Valor&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time Step&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Apple: Historia del precio la acción al cierre. Escala (0,1)&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_49_0.png" src="../../_images/Taller_Series_de_Tiempo_49_0.png" />
</div>
</div>
<section id="span-style-color-red-base-de-datos-weather-span">
<h3><span style="color:red">Base de Datos “Weather”</span><a class="headerlink" href="#span-style-color-red-base-de-datos-weather-span" title="Permalink to this headline">#</a></h3>
<p>Se utiliza la base de datos de clima del <a class="reference external" href="https://www.bgc-jena.mpg.de/wetter/">Instituto Max Planck de Biogeoquímica</a>. Esta cuenta con 14 variables como temperatura del aire y presión atmosférica. Se trabajará con datos entre 2009 y 2016 recolectados cada 10 minutos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zip_path</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span>
    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;https://storage.googleapis.com/tensorflow/tf-keras-datasets/jena_climate_2009_2016.csv.zip&#39;</span><span class="p">,</span>
    <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;jena_climate_2009_2016.csv.zip&#39;</span><span class="p">,</span>
    <span class="n">cache_dir</span><span class="o">=</span><span class="s1">&#39;/media/storage&#39;</span><span class="p">,</span> <span class="c1">#dirección de extracción</span>
    <span class="n">cache_subdir</span><span class="o">=</span><span class="s1">&#39;Datasets&#39;</span><span class="p">,</span> <span class="c1">#carpeta que se crea para la extracción</span>
    <span class="n">extract</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">csv_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/media/storage/Datasets/jena_climate_2009_2016.csv
</pre></div>
</div>
</div>
</div>
<p>Aquí sólo se tratará con las observaciones por hora, así que se hará un sub muestreo en el que se recogerá cada sexto dato.</p>
<p>También se podría hacer una agregación de los datos con la función <code class="docutils literal notranslate"><span class="pre">df.resample('H',</span> <span class="pre">origin='start').agg('mean')</span></code> si se quiere resumir el comportamiento dentro de la hora</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">5</span><span class="p">::</span><span class="mi">6</span><span class="p">]</span>

<span class="n">date_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.%m.%Y %H:%M:%S&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>996.50</td>
      <td>-8.05</td>
      <td>265.38</td>
      <td>-8.78</td>
      <td>94.4</td>
      <td>3.33</td>
      <td>3.14</td>
      <td>0.19</td>
      <td>1.96</td>
      <td>3.15</td>
      <td>1307.86</td>
      <td>0.21</td>
      <td>0.63</td>
      <td>192.7</td>
    </tr>
    <tr>
      <th>11</th>
      <td>996.62</td>
      <td>-8.88</td>
      <td>264.54</td>
      <td>-9.77</td>
      <td>93.2</td>
      <td>3.12</td>
      <td>2.90</td>
      <td>0.21</td>
      <td>1.81</td>
      <td>2.91</td>
      <td>1312.25</td>
      <td>0.25</td>
      <td>0.63</td>
      <td>190.3</td>
    </tr>
    <tr>
      <th>17</th>
      <td>996.84</td>
      <td>-8.81</td>
      <td>264.59</td>
      <td>-9.66</td>
      <td>93.5</td>
      <td>3.13</td>
      <td>2.93</td>
      <td>0.20</td>
      <td>1.83</td>
      <td>2.94</td>
      <td>1312.18</td>
      <td>0.18</td>
      <td>0.63</td>
      <td>167.2</td>
    </tr>
    <tr>
      <th>23</th>
      <td>996.99</td>
      <td>-9.05</td>
      <td>264.34</td>
      <td>-10.02</td>
      <td>92.6</td>
      <td>3.07</td>
      <td>2.85</td>
      <td>0.23</td>
      <td>1.78</td>
      <td>2.85</td>
      <td>1313.61</td>
      <td>0.10</td>
      <td>0.38</td>
      <td>240.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>997.46</td>
      <td>-9.63</td>
      <td>263.72</td>
      <td>-10.65</td>
      <td>92.2</td>
      <td>2.94</td>
      <td>2.71</td>
      <td>0.23</td>
      <td>1.69</td>
      <td>2.71</td>
      <td>1317.19</td>
      <td>0.40</td>
      <td>0.88</td>
      <td>157.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hacemos la gráfica de algunas variables para ver su comportamiento</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">,</span> <span class="s1">&#39;p (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;rho (g/m**3)&#39;</span><span class="p">]</span>
<span class="n">plot_features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">]</span>
<span class="n">plot_features</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">date_time</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot_features</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plot_features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">][:</span><span class="mi">480</span><span class="p">]</span>
<span class="n">plot_features</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">date_time</span><span class="p">[:</span><span class="mi">480</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot_features</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_56_0.png" src="../../_images/Taller_Series_de_Tiempo_56_0.png" />
<img alt="../../_images/Taller_Series_de_Tiempo_56_1.png" src="../../_images/Taller_Series_de_Tiempo_56_1.png" />
</div>
</div>
</section>
<section id="span-style-color-red-pre-procesamiento-span">
<h3><span style="color:red">Pre procesamiento</span><a class="headerlink" href="#span-style-color-red-pre-procesamiento-span" title="Permalink to this headline">#</a></h3>
<p>Por supuesto, para poder generar un modelo correctamente, es necesario entender los datos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>p (mbar)</th>
      <td>70091.0</td>
      <td>989.212842</td>
      <td>8.358886</td>
      <td>913.60</td>
      <td>984.20</td>
      <td>989.57</td>
      <td>994.720</td>
      <td>1015.29</td>
    </tr>
    <tr>
      <th>T (degC)</th>
      <td>70091.0</td>
      <td>9.450482</td>
      <td>8.423384</td>
      <td>-22.76</td>
      <td>3.35</td>
      <td>9.41</td>
      <td>15.480</td>
      <td>37.28</td>
    </tr>
    <tr>
      <th>Tpot (K)</th>
      <td>70091.0</td>
      <td>283.493086</td>
      <td>8.504424</td>
      <td>250.85</td>
      <td>277.44</td>
      <td>283.46</td>
      <td>289.530</td>
      <td>311.21</td>
    </tr>
    <tr>
      <th>Tdew (degC)</th>
      <td>70091.0</td>
      <td>4.956471</td>
      <td>6.730081</td>
      <td>-24.80</td>
      <td>0.24</td>
      <td>5.21</td>
      <td>10.080</td>
      <td>23.06</td>
    </tr>
    <tr>
      <th>rh (%)</th>
      <td>70091.0</td>
      <td>76.009788</td>
      <td>16.474920</td>
      <td>13.88</td>
      <td>65.21</td>
      <td>79.30</td>
      <td>89.400</td>
      <td>100.00</td>
    </tr>
    <tr>
      <th>VPmax (mbar)</th>
      <td>70091.0</td>
      <td>13.576576</td>
      <td>7.739883</td>
      <td>0.97</td>
      <td>7.77</td>
      <td>11.82</td>
      <td>17.610</td>
      <td>63.77</td>
    </tr>
    <tr>
      <th>VPact (mbar)</th>
      <td>70091.0</td>
      <td>9.533968</td>
      <td>4.183658</td>
      <td>0.81</td>
      <td>6.22</td>
      <td>8.86</td>
      <td>12.360</td>
      <td>28.25</td>
    </tr>
    <tr>
      <th>VPdef (mbar)</th>
      <td>70091.0</td>
      <td>4.042536</td>
      <td>4.898549</td>
      <td>0.00</td>
      <td>0.87</td>
      <td>2.19</td>
      <td>5.300</td>
      <td>46.01</td>
    </tr>
    <tr>
      <th>sh (g/kg)</th>
      <td>70091.0</td>
      <td>6.022560</td>
      <td>2.655812</td>
      <td>0.51</td>
      <td>3.92</td>
      <td>5.59</td>
      <td>7.800</td>
      <td>18.07</td>
    </tr>
    <tr>
      <th>H2OC (mmol/mol)</th>
      <td>70091.0</td>
      <td>9.640437</td>
      <td>4.234862</td>
      <td>0.81</td>
      <td>6.29</td>
      <td>8.96</td>
      <td>12.490</td>
      <td>28.74</td>
    </tr>
    <tr>
      <th>rho (g/m**3)</th>
      <td>70091.0</td>
      <td>1216.061232</td>
      <td>39.974263</td>
      <td>1059.45</td>
      <td>1187.47</td>
      <td>1213.80</td>
      <td>1242.765</td>
      <td>1393.54</td>
    </tr>
    <tr>
      <th>wv (m/s)</th>
      <td>70091.0</td>
      <td>1.702567</td>
      <td>65.447512</td>
      <td>-9999.00</td>
      <td>0.99</td>
      <td>1.76</td>
      <td>2.860</td>
      <td>14.01</td>
    </tr>
    <tr>
      <th>max. wv (m/s)</th>
      <td>70091.0</td>
      <td>2.963041</td>
      <td>75.597657</td>
      <td>-9999.00</td>
      <td>1.76</td>
      <td>2.98</td>
      <td>4.740</td>
      <td>23.50</td>
    </tr>
    <tr>
      <th>wd (deg)</th>
      <td>70091.0</td>
      <td>174.789095</td>
      <td>86.619431</td>
      <td>0.00</td>
      <td>125.30</td>
      <td>198.10</td>
      <td>234.000</td>
      <td>360.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>¿Qué llama la atención? el mínimo de las variables de velocidad de viento es -9999, un valor probablemente erroneo que puede causar problemas como sesgo.
Además, como se tiene una variable de la dirección del viento, la velocidad siempre debe ser mayor o igual a cero. Arreglemos esto</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wv</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wv (m/s)&#39;</span><span class="p">]</span>
<span class="n">bad_wv</span> <span class="o">=</span> <span class="n">wv</span> <span class="o">==</span> <span class="o">-</span><span class="mf">9999.0</span>
<span class="n">wv</span><span class="p">[</span><span class="n">bad_wv</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">max_wv</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;max. wv (m/s)&#39;</span><span class="p">]</span>
<span class="n">bad_max_wv</span> <span class="o">=</span> <span class="n">max_wv</span> <span class="o">==</span> <span class="o">-</span><span class="mf">9999.0</span>
<span class="n">max_wv</span><span class="p">[</span><span class="n">bad_max_wv</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># revisamos si los cambios se muestran en el dataframe</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;wv (m/s)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>Ahora nos adentramos en cosas más específicas con algunas variables……</p>
<section id="viento">
<h4>Viento<a class="headerlink" href="#viento" title="Permalink to this headline">#</a></h4>
<p>La columna de dirección del viento está en ángulos, lo cual no es buena variable de entrada para un modelo.</p>
<p>Veamos cómo se ven los datos de viento</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wd (deg)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wv (m/s)&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wind Direction [deg]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Wind Velocity [m/s]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Wind Velocity [m/s]&#39;)
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_64_1.png" src="../../_images/Taller_Series_de_Tiempo_64_1.png" />
</div>
</div>
<p>Las variables de dirección y velocidad del viento serán más sencillas de interpretar para el modelo si las convertimos en vectores</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wv</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wv (m/s)&#39;</span><span class="p">)</span>
<span class="n">max_wv</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max. wv (m/s)&#39;</span><span class="p">)</span>

<span class="c1"># Convertir a radianes.</span>
<span class="n">wd_rad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wd (deg)&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>

<span class="c1"># Calcular los componentes bidimensionales del viento.</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>

<span class="c1"># Se repite el proceso con el viento máximo.</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;max Wx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;max Wy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>La distribución del viento ahora será más fácil de entender</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wx&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wy&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wind X [m/s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Wind Y [m/s]&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-11.305513973134667, 8.24469928549079, -8.27438540335515, 7.7338312955467785)
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_68_1.png" src="../../_images/Taller_Series_de_Tiempo_68_1.png" />
</div>
</div>
</section>
<section id="tiempo">
<h4>Tiempo<a class="headerlink" href="#tiempo" title="Permalink to this headline">#</a></h4>
<p>Además, la columna de tiempo nos brindará información importante, pero hay que convertirla a algo verdaderamente utilizable</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">date_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5        2009-01-01 01:00:00
11       2009-01-01 02:00:00
17       2009-01-01 03:00:00
23       2009-01-01 04:00:00
29       2009-01-01 05:00:00
                 ...        
420521   2016-12-31 19:10:00
420527   2016-12-31 20:10:00
420533   2016-12-31 21:10:00
420539   2016-12-31 22:10:00
420545   2016-12-31 23:10:00
Name: Date Time, Length: 70091, dtype: datetime64[ns]
</pre></div>
</div>
</div>
</div>
<p>Como estos son datos climáticos, se puede suponer que se tiene tanto periodicidad en el día como en el año, pero los datos en este formato no lo repesentan correctamente. Para aprovechar esta información, usaremos transformaciones de seno y coseno.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Convertimos los datos a segundos ##PELIGRO, NO USAR ASÍ</span>

<span class="n">timestamp_s</span> <span class="o">=</span> <span class="n">date_time</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
<span class="c1">#obtenemos el seno y coseno para obtener señales más claras</span>

<span class="n">day</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
<span class="n">year</span> <span class="o">=</span> <span class="p">(</span><span class="mf">365.2425</span><span class="p">)</span><span class="o">*</span><span class="n">day</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Day sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">day</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Day cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">day</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">year</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">year</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Day sin&#39;</span><span class="p">])[:</span><span class="mi">25</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Day cos&#39;</span><span class="p">])[:</span><span class="mi">25</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [h]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Time of day signal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Time of day signal&#39;)
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_73_1.png" src="../../_images/Taller_Series_de_Tiempo_73_1.png" />
</div>
</div>
</section>
<section id="separacion-de-los-datos">
<h4>Separación de los datos<a class="headerlink" href="#separacion-de-los-datos" title="Permalink to this headline">#</a></h4>
<p>Haremos un clásico corte de los datos (70%, 20%, 10%) para entrenamiento, Validación y test. Que se note que no se está haciendo shuffle en este caso</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">column_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.7</span><span class="p">)]</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.7</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.9</span><span class="p">)]</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.9</span><span class="p">):]</span>

<span class="n">num_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="normalizacion-de-los-datos">
<h4>Normalización de los datos<a class="headerlink" href="#normalizacion-de-los-datos" title="Permalink to this headline">#</a></h4>
<p>Práctica común para evitar sesgo en los datos. Aquí se hace manualmente</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_mean</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">train_std</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">train_df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">val_df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
</pre></div>
</div>
</div>
</div>
<p>Observemos las distribuciones de los datos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
<span class="n">df_std</span> <span class="o">=</span> <span class="n">df_std</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Normalized&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Normalized&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_std</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_79_0.png" src="../../_images/Taller_Series_de_Tiempo_79_0.png" />
</div>
</div>
</section>
</section>
<section id="span-style-color-red-ventaneo-de-datos-span">
<h3><span style="color:red">Ventaneo de Datos</span><a class="headerlink" href="#span-style-color-red-ventaneo-de-datos-span" title="Permalink to this headline">#</a></h3>
<p>Los modelos que usaremos tendrán como datos de entrada “ventanas” de datos consecutivos. Estas tienen las siguientes características:</p>
<ul class="simple">
<li><p>el numero de “pasos” de las ventanas de entrada y labels</p></li>
<li><p>el “offset” entre los anteriores</p></li>
<li><p>las variables que son usadas como entrada, labels o ambos.</p></li>
</ul>
<p>Se van a construir distintas ventanas para modelos de salida univariada, salida multivariada, a un paso o multi paso.</p>
<p>Por ejemplo, definimos un modelo con ventanas de 24 horas en el pasado para predecir un paso a 24 en el futuro</p>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/raw_window_24h.png" 
     alt="ventaneo_24-24" width="500">
<center>
<p>O un modelo que predice una hora en el futuro, dadas 6 horas de historia</p>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/raw_window_1h.png" 
     alt="ventaneo_6-1" width="500">
<center><p>A continuación definiremos una clase llamada <code class="docutils literal notranslate"><span class="pre">windowGenerator</span></code> que sea capaz de:</p>
<ul class="simple">
<li><p>Manejar indices y offsets</p></li>
<li><p>Hacer un ventaneo de pares <code class="docutils literal notranslate"><span class="pre">(variables,</span> <span class="pre">labels)</span></code></p></li>
<li><p>hacer gráficos de las ventanas</p></li>
<li><p>Generar lotes de dichas ventanas para entrenamiento, validación y prueba</p></li>
</ul>
<section id="indices-y-offsets">
<h4>Índices y offsets<a class="headerlink" href="#indices-y-offsets" title="Permalink to this headline">#</a></h4>
<p>Comenzamos a generar la clase <code class="docutils literal notranslate"><span class="pre">WindowGenerator</span></code>. el método <code class="docutils literal notranslate"><span class="pre">__init__</span></code> define los indices de los datos de entrada y los labels</p>
<p>Luego toma los datos de entrenamiento, validación y prueba y los convierte en <code class="docutils literal notranslate"><span class="pre">tf.Data.Dataset</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WindowGenerator</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_width</span><span class="p">,</span> <span class="n">label_width</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span>
               <span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="o">=</span><span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="o">=</span><span class="n">test_df</span><span class="p">,</span>
               <span class="n">label_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Guarda los datos en crudo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_df</span> <span class="o">=</span> <span class="n">val_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span>

        <span class="c1"># Se trabajan las columnas de labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span> <span class="o">=</span> <span class="n">label_columns</span>
        <span class="k">if</span> <span class="n">label_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">label_columns_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span>
                                        <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_columns</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span>
                               <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>

        <span class="c1"># Definimos los parámetros de las ventanas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_width</span> <span class="o">=</span> <span class="n">input_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span> <span class="o">=</span> <span class="n">label_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span> <span class="o">=</span> <span class="n">input_width</span> <span class="o">+</span> <span class="n">shift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">input_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span><span class="p">]</span>
    
    <span class="c1">#Método para representar los objetos en forma de string</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="sa">f</span><span class="s1">&#39;Total window size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;Input indices: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;Label indices: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;Label column name(s): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Creamos las ventanas de los ejemplos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w1</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                     <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>
<span class="n">w1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 48
Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23]
Label indices: [47]
Label column name(s): [&#39;T (degC)&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w2</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>
<span class="n">w2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 7
Input indices: [0 1 2 3 4 5]
Label indices: [6]
Label column name(s): [&#39;T (degC)&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="corte">
<h4>Corte<a class="headerlink" href="#corte" title="Permalink to this headline">#</a></h4>
<p>Dada una lista de entradas consecutivas, el método <code class="docutils literal notranslate"><span class="pre">split_window</span></code> hará la conversión a ventanas de entradas y labels</p>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/split_window.png" 
     alt="ventaneo_6-1" width="500">
<center><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">labels</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># El corte no conserva la información sobre la forma, </span>
    <span class="c1"># Por eso es mejor definir las formas para llenar correctamente los datasets</span>
    <span class="n">inputs</span><span class="o">.</span><span class="n">set_shape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_width</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">set_shape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span>

<span class="c1">#Definimos la función recién hecha como método de WindowGenerator</span>
<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">split_window</span> <span class="o">=</span> <span class="n">split_window</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apilamos tres cortes, la longitud total de la ventana</span>
<span class="n">example_window</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[:</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">100</span><span class="o">+</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">200</span><span class="o">+</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">])])</span>

<span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="o">=</span> <span class="n">w2</span><span class="o">.</span><span class="n">split_window</span><span class="p">(</span><span class="n">example_window</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All shapes are: (batch, time, features)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Window shape: </span><span class="si">{</span><span class="n">example_window</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inputs shape: </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Labels shape: </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>All shapes are: (batch, time, features)
Window shape: (3, 7, 19)
Inputs shape: (3, 6, 19)
Labels shape: (3, 1, 1)
</pre></div>
</div>
</div>
</div>
</section>
<section id="graficas">
<h4>Gráficas<a class="headerlink" href="#graficas" title="Permalink to this headline">#</a></h4>
<p>Agregamos un método para visualizar los cortes de las ventanas</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w2</span><span class="o">.</span><span class="n">example</span> <span class="o">=</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_col</span><span class="o">=</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">,</span> <span class="n">max_subplots</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">example</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plot_col_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span><span class="p">[</span><span class="n">plot_col</span><span class="p">]</span>
    <span class="n">max_n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_subplots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_n</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">max_n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">plot_col</span><span class="si">}</span><span class="s1"> [normed]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span><span class="p">,</span> <span class="n">inputs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:,</span> <span class="n">plot_col_index</span><span class="p">],</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Inputs&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">:</span>
            <span class="n">label_col_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plot_col</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label_col_index</span> <span class="o">=</span> <span class="n">plot_col_index</span>

        <span class="k">if</span> <span class="n">label_col_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:,</span> <span class="n">label_col_index</span><span class="p">],</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Labels&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#2ca02c&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:,</span> <span class="n">label_col_index</span><span class="p">],</span>
                      <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predictions&#39;</span><span class="p">,</span>
                      <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#ff7f0e&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [h]&#39;</span><span class="p">)</span>

<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_94_0.png" src="../../_images/Taller_Series_de_Tiempo_94_0.png" />
</div>
</div>
</section>
<section id="creacion-de-datasets">
<h4>Creación de Datasets<a class="headerlink" href="#creacion-de-datasets" title="Permalink to this headline">#</a></h4>
<p>Finalmente, creamos un método que toma el Dataframe de series de tiempo y lo convierte en <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code> como pares de forma <code class="docutils literal notranslate"><span class="pre">(input_window,</span> <span class="pre">label_window)</span></code>. esto se logra usando la función <code class="docutils literal notranslate"><span class="pre">preprocessing.timeseries_dataset_from_array</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">timeseries_dataset_from_array</span><span class="p">(</span>
          <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
          <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">sequence_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">,</span>
          <span class="n">sequence_stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
          <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">split_window</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ds</span>

<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">make_dataset</span> <span class="o">=</span> <span class="n">make_dataset</span>
</pre></div>
</div>
</div>
</div>
<p>Podemos agregar propiedades para poder acceder a los datos de entrenamiento, validación y prueba como Datasets de tensorflow, utilizando la función que acabamos de crear. Además agregamos un lote de ejemplo para gráficos rápidos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_df</span><span class="p">)</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_df</span><span class="p">)</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_df</span><span class="p">)</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Se toma y se guarda en el caché un lote de ejemplo de &#39;Entradas y labels&#39; para gráficar&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_example&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># No se encontró un lote, así que creamos uno del dataset &#39;.train&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">))</span>
        <span class="c1"># se guarda en el caché para futuros usos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_example</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">example</span> <span class="o">=</span> <span class="n">example</span>
</pre></div>
</div>
</div>
</div>
<p>Ahora tenemos acceso a los datasets como objetos de tensorflow!</p>
<p>E iterar sobre esos, genera lotes concretos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w2</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">element_spec</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(TensorSpec(shape=(None, 6, 19), dtype=tf.float32, name=None),
 TensorSpec(shape=(None, 1, 1), dtype=tf.float32, name=None))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="ow">in</span> <span class="n">w2</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inputs shape (batch, time, features): </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Labels shape (batch, time, features): </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inputs shape (batch, time, features): (32, 6, 19)
Labels shape (batch, time, features): (32, 1, 1)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="span-style-color-red-modelo-a-un-paso-span">
<h3><span style="color:red">Modelo a un paso</span><a class="headerlink" href="#span-style-color-red-modelo-a-un-paso-span" title="Permalink to this headline">#</a></h3>
<p>Este es el modelo más sencillo de construir.Predecimos una única variable con una historia de un paso a un paso en el futuro.</p>
<p>Comenzaremos prediciendo la variable <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">(degC)</span></code></p>
<p>Configuramos <code class="docutils literal notranslate"><span class="pre">WindowGenerator</span></code> para que produzca pares a un paso con la varible a predecir</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single_step_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
    <span class="n">input_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>
<span class="n">single_step_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 2
Input indices: [0]
Label indices: [1]
Label column name(s): [&#39;T (degC)&#39;]
</pre></div>
</div>
</div>
</div>
<p>Generamos los tres datasets e iteramos sobre ellos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="ow">in</span> <span class="n">single_step_window</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inputs shape (batch, time, features): </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Labels shape (batch, time, features): </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inputs shape (batch, time, features): (32, 1, 19)
Labels shape (batch, time, features): (32, 1, 1)
</pre></div>
</div>
</div>
</div>
<section id="base-de-referencia">
<h4>Base de referencia<a class="headerlink" href="#base-de-referencia" title="Permalink to this headline">#</a></h4>
<p>Antes de armar el modelo, es buena idea tener una base de referencia para el rendimiendo con respecto a los modelos más complejos</p>
<p>Aquí haremos un modelo que hace una predicción en el futuro dado los datos actuales. El modelo retorna la temperatura actual y predice si hubo cambios o no.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Baseline</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span> <span class="o">=</span> <span class="n">label_index</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">inputs</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">tf</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Instanciamos y evaluamos el modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseline</span> <span class="o">=</span> <span class="n">Baseline</span><span class="p">(</span><span class="n">label_index</span><span class="o">=</span><span class="n">column_indices</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>

<span class="n">baseline</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                 <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="n">val_performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>439/439 [==============================] - 1s 2ms/step - loss: 0.0128 - mean_absolute_error: 0.0785
</pre></div>
</div>
</div>
</div>
<p>Lastimosamente estas métricas no nos dicen mucho de cómo trabaja el modelo</p>
<p>Podemos graficar las métricas de este modelo, pero la verdad no hay mucho que observar con una sola muestra.</p>
<p>Razón por la cual creamos una ventana de 24 horas de entradas consecutivas y labels de una vez. Esto no cambia lo que hace el modelo. Estamos haciendo una predicción cada hora durante 24 horas</p>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/last_window.png" 
     alt="ventaneo_6-1" width="500">
<center><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
    <span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>

<span class="n">wide_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 25
Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23]
Label indices: [ 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24]
Label column name(s): [&#39;T (degC)&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input shape:&#39;</span><span class="p">,</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output shape:&#39;</span><span class="p">,</span> <span class="n">baseline</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 24, 19)
Output shape: (32, 24, 1)
</pre></div>
</div>
</div>
</div>
<p>Ahora si obtendremos gráficos más interesantes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_115_0.png" src="../../_images/Taller_Series_de_Tiempo_115_0.png" />
</div>
</div>
</section>
<section id="modelo-lineal">
<h4>Modelo Lineal<a class="headerlink" href="#modelo-lineal" title="Permalink to this headline">#</a></h4>
<p>Aplicamos una transformación lineal entre la entrada y la salida.</p>
<p>Esto lo logramos con una capa densa sin función de activación</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linear</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input shape:&#39;</span><span class="p">,</span> <span class="n">single_step_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output shape:&#39;</span><span class="p">,</span> <span class="n">linear</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 1, 19)
Output shape: (32, 1, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MAX_EPOCHS</span> <span class="o">=</span> <span class="mi">20</span>

<span class="k">def</span> <span class="nf">compile_and_fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">early_stopping</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span>
                                                    <span class="n">patience</span><span class="o">=</span><span class="n">patience</span><span class="p">,</span>
                                                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">MAX_EPOCHS</span><span class="p">,</span>
                      <span class="n">validation_data</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                      <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">history</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">linear</span><span class="p">,</span> <span class="n">single_step_window</span><span class="p">)</span>

<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
1534/1534 [==============================] - 5s 3ms/step - loss: 0.1825 - mean_absolute_error: 0.2438 - val_loss: 0.0099 - val_mean_absolute_error: 0.0734
Epoch 2/20
1534/1534 [==============================] - 6s 4ms/step - loss: 0.0095 - mean_absolute_error: 0.0716 - val_loss: 0.0089 - val_mean_absolute_error: 0.0690
Epoch 3/20
1534/1534 [==============================] - 6s 4ms/step - loss: 0.0091 - mean_absolute_error: 0.0697 - val_loss: 0.0088 - val_mean_absolute_error: 0.0689
Epoch 4/20
1534/1534 [==============================] - 6s 4ms/step - loss: 0.0090 - mean_absolute_error: 0.0697 - val_loss: 0.0087 - val_mean_absolute_error: 0.0685
Epoch 5/20
1534/1534 [==============================] - 7s 4ms/step - loss: 0.0090 - mean_absolute_error: 0.0696 - val_loss: 0.0088 - val_mean_absolute_error: 0.0694
Epoch 6/20
1534/1534 [==============================] - 11s 7ms/step - loss: 0.0090 - mean_absolute_error: 0.0696 - val_loss: 0.0086 - val_mean_absolute_error: 0.0680
Epoch 7/20
1534/1534 [==============================] - 10s 6ms/step - loss: 0.0090 - mean_absolute_error: 0.0696 - val_loss: 0.0086 - val_mean_absolute_error: 0.0681
Epoch 8/20
1534/1534 [==============================] - 10s 7ms/step - loss: 0.0090 - mean_absolute_error: 0.0695 - val_loss: 0.0088 - val_mean_absolute_error: 0.0691
439/439 [==============================] - 2s 5ms/step - loss: 0.0088 - mean_absolute_error: 0.0691
</pre></div>
</div>
</div>
</div>
<p>Igual que el modelo anterior, este se puede aplicar en lotes de ventanas amplias, haciendo predicciones independientes de manera consecutiva.</p>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/wide_window.png" 
     alt="ventaneo_6-1" width="500">
</center><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input shape:&#39;</span><span class="p">,</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output shape:&#39;</span><span class="p">,</span> <span class="n">baseline</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 24, 19)
Output shape: (32, 24, 1)
</pre></div>
</div>
</div>
</div>
<p>Vamos a graficar las predicciones. ¿Se nota una mejora al modelo anterior?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_124_0.png" src="../../_images/Taller_Series_de_Tiempo_124_0.png" />
</div>
</div>
<p>como es un modelo lineal, es sencillo de interpretar los pesos de este.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span>
        <span class="n">height</span><span class="o">=</span><span class="n">linear</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">kernel</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">axis</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_126_0.png" src="../../_images/Taller_Series_de_Tiempo_126_0.png" />
</div>
</div>
</section>
<section id="denso-multi-paso">
<h4>Denso Multi paso<a class="headerlink" href="#denso-multi-paso" title="Permalink to this headline">#</a></h4>
<p>El modelo a un paso no tiene contexto de los valores actuales, ni ve como estos cambian a través del tiempo. Para arreglar esto, usamos varios pasos de tiempo como entrada del modelo.</p>
<p>Los modelos anteriores tomaban cada paso de manera independiente. Aquí comenzará a tomar varios pasos como entrada para generar una sola salida</p>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/conv_window.png" 
     alt="ventaneo_6-1" width="300">
<center><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CONV_WIDTH</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">conv_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
    <span class="n">input_width</span><span class="o">=</span><span class="n">CONV_WIDTH</span><span class="p">,</span>
    <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>

<span class="n">conv_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 4
Input indices: [0 1 2]
Label indices: [3]
Label column name(s): [&#39;T (degC)&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conv_window</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Given 3 hours of inputs, predict 1 hour into the future.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Given 3 hours of inputs, predict 1 hour into the future.&#39;)
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_130_1.png" src="../../_images/Taller_Series_de_Tiempo_130_1.png" />
</div>
</div>
<p>Logramos entrenar este modelo de multiple entrada agregando <code class="docutils literal notranslate"><span class="pre">tf.keras.layers.Flatten</span></code> como la primera capa</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_step_dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># Shape: (time, features) =&gt; (time*features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="c1"># Add back the time dimension.</span>
    <span class="c1"># Shape: (outputs) =&gt; (1, outputs)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input shape:&#39;</span><span class="p">,</span> <span class="n">conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output shape:&#39;</span><span class="p">,</span> <span class="n">multi_step_dense</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 3, 19)
Output shape: (32, 1, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_step_dense</span><span class="p">,</span> <span class="n">conv_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;Multi step dense&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_step_dense</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;Multi step dense&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_step_dense</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>438/438 [==============================] - 2s 4ms/step - loss: 0.0063 - mean_absolute_error: 0.0557
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conv_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_step_dense</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_135_0.png" src="../../_images/Taller_Series_de_Tiempo_135_0.png" />
</div>
</div>
</section>
</section>
<section id="red-recurrente">
<h3>Red Recurrente<a class="headerlink" href="#red-recurrente" title="Permalink to this headline">#</a></h3>
<p>La preferente para datos secuenciales/Series de tiempo.</p>
<p>En este caso usaremos una capa <code class="docutils literal notranslate"><span class="pre">layers.LSTM</span></code>. Un parámetro importante de estas es el <code class="docutils literal notranslate"><span class="pre">return_sequences</span></code>, cuyo valor puede implicar dos cosas:</p>
<ul class="simple">
<li><p>Falso: la capa tiene de salida el último paso de tiempo.</p></li>
</ul>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/lstm_1_window.png" 
     alt="ventaneo_6-1" width="300">
</center>
<ul class="simple">
<li><p>Verdadero: habrá una salida por cada dato de entrada. Esto es principalmente usado cuando se tienen varias capas recurrentes</p></li>
</ul>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/lstm_many_window.png" 
     alt="ventaneo_6-1" width="300">
</center><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># forma [lote, pasos, variables] =&gt; [lote, pasos, unidades_lstm]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="c1"># forma =&gt; [lote, pasos, features]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Con el <code class="docutils literal notranslate"><span class="pre">return_sequences=True</span></code>, el modelo se puede hacer un entrenamiendo de 24 horas a la vez</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input shape:&#39;</span><span class="p">,</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output shape:&#39;</span><span class="p">,</span> <span class="n">lstm_model</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 24, 19)
Output shape: (32, 24, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">lstm_model</span><span class="p">,</span> <span class="n">wide_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 99/438 [=====&gt;........................] - ETA: 1s - loss: 0.0056 - mean_absolute_error: 0.0511438/438 [==============================] - 2s 4ms/step - loss: 0.0056 - mean_absolute_error: 0.0510
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lstm_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_141_0.png" src="../../_images/Taller_Series_de_Tiempo_141_0.png" />
</div>
</div>
<section id="rendimiento">
<h4>Rendimiento<a class="headerlink" href="#rendimiento" title="Permalink to this headline">#</a></h4>
<p>Vamos a ver cómo se diferencian los modelos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">performance</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">metric_name</span> <span class="o">=</span> <span class="s1">&#39;mean_absolute_error&#39;</span>
<span class="n">metric_index</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">metrics_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">)</span>
<span class="n">val_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val_performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">test_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;mean_absolute_error [T (degC), normalized]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">val_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">test_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">performance</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
           <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_143_0.png" src="../../_images/Taller_Series_de_Tiempo_143_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s1">12s</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Baseline    : 0.0852
Linear      : 0.0681
Multi step dense: 0.0554
LSTM        : 0.0516
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelos-multivariados">
<h4>Modelos multivariados<a class="headerlink" href="#modelos-multivariados" title="Permalink to this headline">#</a></h4>
<p>Hasta ahora sólo hemos lidiado con predicciones de una variable, pero esto facilmente se puede extender a casos multivariados. Esto se hace cambiando la ventana de labels a la cantidad que buscamos</p>
<p>Observemos cómo se comporta la red recurrente con predicciones multivariadas</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">wide_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
    <span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">wide_window</span><span class="p">)</span>

<span class="n">lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># forma [lote, pasos, variables] =&gt; [lotes, pasos, unidades_lstm]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="c1"># forma =&gt; [lote, pasos, variables]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">num_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">lstm_model</span><span class="p">,</span> <span class="n">wide_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 23/438 [&gt;.............................] - ETA: 0s - loss: 0.0611 - mean_absolute_error: 0.1197 438/438 [==============================] - 2s 4ms/step - loss: 0.0617 - mean_absolute_error: 0.1203

CPU times: user 4min 31s, sys: 55.9 s, total: 5min 27s
Wall time: 2min 15s
</pre></div>
</div>
</div>
</div>
<p>Vemos que el valor “MAE” en el caso multivariado es mayor al del caso univariado. ¿cuál es la razón de esto?</p>
</section>
</section>
<section id="span-style-color-red-modelo-multi-paso-span">
<h3><span style="color:red">Modelo multi paso</span><a class="headerlink" href="#span-style-color-red-modelo-multi-paso-span" title="Permalink to this headline">#</a></h3>
<p>A pesar de hacer predicciones en grandes ventanas de tiempo, los modelos anteriores siguen haciendo predicciones a una hora en el futuro. Aquí, los modelos comenzaran a predecir múltiples pasos en el futuro, generando una franja completa de tiempo</p>
<p>Primero, generamos ventanas con 24 horas de historia para predecir 24 horas en el futuro</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">OUT_STEPS</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">multi_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                               <span class="n">label_width</span><span class="o">=</span><span class="n">OUT_STEPS</span><span class="p">,</span>
                               <span class="n">shift</span><span class="o">=</span><span class="n">OUT_STEPS</span><span class="p">)</span>

<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">multi_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 48
Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23]
Label indices: [24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47]
Label column name(s): None
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_150_1.png" src="../../_images/Taller_Series_de_Tiempo_150_1.png" />
</div>
</div>
<section id="id1">
<h4>Base de referencia<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<p>Haremos un modelo de referencia que simplemente repita el último paso de entrada para cada ventana de salida</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MultiStepLastBaseline</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">inputs</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">OUT_STEPS</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">last_baseline</span> <span class="o">=</span> <span class="n">MultiStepLastBaseline</span><span class="p">()</span>
<span class="n">last_baseline</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                      <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="n">multi_val_performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">multi_performance</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">&#39;Last&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">&#39;Last&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">last_baseline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 1s 2ms/step - loss: 0.6285 - mean_absolute_error: 0.5007
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_152_1.png" src="../../_images/Taller_Series_de_Tiempo_152_1.png" />
</div>
</div>
<p>Otro punto de referencia es repetir el dato de entrada en las siguientes 24 horas, haceindo la suposición de que el comportamiento va a ser similar en la misma hora</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RepeatBaseline</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">inputs</span>

<span class="n">repeat_baseline</span> <span class="o">=</span> <span class="n">RepeatBaseline</span><span class="p">()</span>
<span class="n">repeat_baseline</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                        <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">&#39;Repeat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">repeat_baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">&#39;Repeat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">repeat_baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">repeat_baseline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 1s 2ms/step - loss: 0.4270 - mean_absolute_error: 0.3959
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_154_1.png" src="../../_images/Taller_Series_de_Tiempo_154_1.png" />
</div>
</div>
</section>
<section id="modelos-single-shot">
<h4>Modelos Single shot<a class="headerlink" href="#modelos-single-shot" title="Permalink to this headline">#</a></h4>
<p>Lo que se va a hacer en este modelo es predecir la secuencia entera de tiempo en un solo paso o en un solo “tiro”. Esto se logra, por ejemplo definiendo las unidades de salida de una capa densa como <code class="docutils literal notranslate"><span class="pre">PASOS_SALIDA*variables</span></code>, después se cambia la forma de las salidas para que el resultado sea como una matriz</p>
<center>
<img src="https://c.tenor.com/u2LD0oM-x30AAAAC/simpsons-makeup.gif" 
     alt="ventaneo_6-1" width="300">
<figcaption>Piénsenlo como una escopeta</figcaption>
</center>
<p>Vamos a revisar los modelos anteriores y los pasaremos a multi paso</p>
</section>
<section id="lineal">
<h4>Lineal<a class="headerlink" href="#lineal" title="Permalink to this headline">#</a></h4>
<p>Este modelo tendrá poca potencia ya que necesita predecir varios puntos a futuro a partir de uno de entrada</p>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/multistep_dense.png" 
     alt="ventaneo_6-1" width="300">
</center><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_linear_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># Toma el último paso de tiempo</span>
    <span class="c1"># forma [lote, tiempo, variables] =&gt; [lotes, 1, variables]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
    <span class="c1"># forma =&gt; [lotes, 1, pasos_salida*variables]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">OUT_STEPS</span><span class="o">*</span><span class="n">num_features</span><span class="p">,</span>
                          <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">initializers</span><span class="o">.</span><span class="n">zeros</span><span class="p">()),</span>
    <span class="c1"># forma =&gt; [lote, pasos_salida, variables]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="n">OUT_STEPS</span><span class="p">,</span> <span class="n">num_features</span><span class="p">])</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_linear_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">&#39;Linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_linear_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">&#39;Linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_linear_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_linear_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 1s 3ms/step - loss: 0.2552 - mean_absolute_error: 0.3048
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_157_1.png" src="../../_images/Taller_Series_de_Tiempo_157_1.png" />
</div>
</div>
</section>
<section id="densa">
<h4>Densa<a class="headerlink" href="#densa" title="Permalink to this headline">#</a></h4>
<p>Agregando una capa densa le dará más poder a la red, pero sigue solo prediciendo a partir de un paso</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_dense_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># Toma el último paso de tiempo</span>
    <span class="c1"># forma [lote, tiempo, variables] =&gt; [lote, 1, variables]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
    <span class="c1"># forma =&gt; [lote, 1, unidades_densas]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="c1"># forma =&gt; [lote, pasos_salida*variables]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">OUT_STEPS</span><span class="o">*</span><span class="n">num_features</span><span class="p">,</span>
                          <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">initializers</span><span class="o">.</span><span class="n">zeros</span><span class="p">()),</span>
    <span class="c1"># forma =&gt; [lote, pasos_salida, variables]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="n">OUT_STEPS</span><span class="p">,</span> <span class="n">num_features</span><span class="p">])</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_dense_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">&#39;Dense&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_dense_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">&#39;Dense&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_dense_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_dense_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 1s 3ms/step - loss: 0.2226 - mean_absolute_error: 0.2827
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_159_1.png" src="../../_images/Taller_Series_de_Tiempo_159_1.png" />
</div>
</div>
</section>
<section id="rnn">
<h4>RNN<a class="headerlink" href="#rnn" title="Permalink to this headline">#</a></h4>
<p>El modelo recurrente es capaz de usar la ventana completa de entradas para la predicción. Se guardará el estado de las últimas 24 horas antes de predecir las siguientes 24 horas.</p>
<p>En este formato “single-shot” solo se produce la salida en el último paso de tiempo, así que definimos <code class="docutils literal notranslate"><span class="pre">return_sequence=False</span></code> en la capa LSTM</p>
<center>
<img src="https://www.tensorflow.org/tutorials/structured_data/images/multistep_lstm.png" 
     alt="ventaneo_6-1" width="300">
</center><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># forma [lote, tiempo, variables] =&gt; [lote, unidades_lstm].</span>
    <span class="c1"># Adding more `lstm_units` just overfits more quickly.</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="c1"># Forma =&gt; [lote, pasos_salida*variables].</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">OUT_STEPS</span><span class="o">*</span><span class="n">num_features</span><span class="p">,</span>
                          <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">initializers</span><span class="o">.</span><span class="n">zeros</span><span class="p">()),</span>
    <span class="c1"># forma =&gt; [lote, pasos_salida, variables].</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="n">OUT_STEPS</span><span class="p">,</span> <span class="n">num_features</span><span class="p">])</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_lstm_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">&#39;LSTM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_lstm_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 1s 3ms/step - loss: 0.2142 - mean_absolute_error: 0.2843
</pre></div>
</div>
<img alt="../../_images/Taller_Series_de_Tiempo_161_1.png" src="../../_images/Taller_Series_de_Tiempo_161_1.png" />
</div>
</div>
</section>
<section id="id2">
<h4>Rendimiento<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multi_performance</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="n">metric_name</span> <span class="o">=</span> <span class="s1">&#39;mean_absolute_error&#39;</span>
<span class="n">metric_index</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">metrics_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">)</span>
<span class="n">val_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi_val_performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">test_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi_performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">val_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">test_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">multi_performance</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
           <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAE (average over all times and outputs)&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Taller_Series_de_Tiempo_163_0.png" src="../../_images/Taller_Series_de_Tiempo_163_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">multi_performance</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s1">8s</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last    : 0.5157
Repeat  : 0.3774
Linear  : 0.2983
Dense   : 0.2775
LSTM    : 0.2761
</pre></div>
</div>
</div>
</div>
<p>¿Vale la pena el esfuerzo por el modelo más complejo?</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AprendizajeProfundo/Libro_Fundamentos_Programacion",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./TensorFlow\Cuadernos"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Álvaro Mauricio Montenegro Díaz, Daniel Mauricio Montenegro Reyes<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>